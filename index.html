<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered SVG to TSX Converter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #e6edf3;
        }

        .font-mono {
            font-family: 'Fira Code', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #161b22;
        }
        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* PrismJS okaidia theme overrides for better contrast and fit */
        pre[class*="language-"] {
            background: transparent;
            border: none;
            padding: 0 !important;
            margin: 0 !important;
            font-size: 0.875rem; /* 14px */
            line-height: 1.5;
        }

        .code-block-container {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 0.5rem;
            transition: all 0.3s ease-in-out;
        }

        .drag-over {
            border-color: #58a6ff;
            background-color: rgba(88, 166, 255, 0.1);
        }

        /* Fade-in animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-primary {
             background-image: linear-gradient(to right, #58a6ff, #316dca);
        }
        
        .btn-primary:hover {
             background-image: linear-gradient(to right, #6ab0ff, #417ddb);
        }

        .btn-secondary {
            background-color: #21262d;
            border: 1px solid #30363d;
        }

        .btn-secondary:hover {
             background-color: #30363d;
        }
        
        .form-input {
            background-color: #0d1117;
            border: 1px solid #30363d;
            color: #e6edf3;
        }

        .form-input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3);
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                SVG to TSX Converter
            </h1>
            <p class="text-gray-400 mt-2 text-lg">
                Instantly convert SVG icons into reusable React components with Gemini AI.
            </p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Column: Input & Controls -->
            <div class="flex flex-col gap-6">
                <div class="flex flex-col gap-4 bg-[#161b22] p-6 rounded-lg border border-[#30363d] shadow-lg h-full">
                    <div>
                        <label for="iconName" class="block text-sm font-medium text-gray-300 mb-2">1. Component Name</label>
                        <input
                            type="text"
                            id="iconName"
                            placeholder="e.g., Analytics, UserProfile"
                            class="w-full form-input rounded-md px-3 py-2 transition"
                        />
                    </div>
                    <div>
                        <label for="svgInput" class="block text-sm font-medium text-gray-300 mb-2">2. Paste SVG Code or Drop File</label>
                        <textarea
                            id="svgInput"
                            placeholder='<svg width="22" height="21" ...>'
                            class="w-full h-48 form-input rounded-md px-3 py-2 transition font-mono text-sm resize-none"
                        ></textarea>
                    </div>
                    <div class="flex items-center text-gray-400">
                        <span class="flex-grow border-t border-[#30363d]"></span>
                        <span class="px-3 text-xs uppercase">Or</span>
                        <span class="flex-grow border-t border-[#30363d]"></span>
                    </div>

                    <input type="file" id="fileInput" class="hidden" accept=".svg" />
                    <button id="uploadButton" class="w-full btn-secondary rounded-md px-4 py-2 text-sm font-semibold flex items-center justify-center gap-2 hover:border-gray-500 transition-colors">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        Upload SVG File
                    </button>
                     <button
                        id="convertButton"
                        class="w-full btn-primary rounded-md px-4 py-3 text-sm font-semibold text-white shadow-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#0d1117] focus:ring-blue-500"
                    >
                        Generate Component
                    </button>
                    <p id="error-message" class="text-red-400 text-sm mt-1 text-center h-5"></p>
                </div>
            </div>

            <!-- Right Column: Preview & Output -->
            <div id="output-panel" class="flex flex-col gap-6">
                <!-- SVG Preview -->
                <div class="bg-[#161b22] p-6 rounded-lg border border-[#30363d] min-h-[200px] flex flex-col justify-center items-center text-center">
                    <h3 class="w-full text-left text-sm font-medium text-gray-300 mb-4">Live Preview</h3>
                    <div id="svg-preview-container" class="flex-grow w-full h-full flex items-center justify-center text-gray-500">
                         <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="opacity-50">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><g><path d="M10.41,17.41a2,2,0,0,0,2.83,0l3.17-3.17a2,2,0,0,0,0-2.83L13.24,8.24a2,2,0,0,0-2.83,0L7.24,11.41a2,2,0,0,0,0,2.83Z"></path></g>
                        </svg>
                        <span class="ml-4">Your SVG will be previewed here.</span>
                    </div>
                </div>

                <!-- TSX Output -->
                <div id="output-container" class="code-block-container p-6 flex-grow flex-col transition-all duration-300 ease-in-out hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="output-filename" class="text-lg font-semibold text-gray-300"></h3>
                        <div class="flex gap-2">
                             <button id="copyButton" title="Copy to clipboard" class="p-2 rounded-md btn-secondary text-gray-400 hover:text-white transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                            </button>
                             <button id="downloadButton" title="Download .tsx file" class="p-2 rounded-md btn-secondary text-gray-400 hover:text-white transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            </button>
                        </div>
                    </div>
                    <pre class="w-full h-[350px] overflow-auto flex-grow"><code id="output-code" class="language-tsx"></code></pre>
                </div>
            </div>
        </main>
    </div>

    <!-- Prism JS for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const iconNameInput = document.getElementById('iconName');
            const svgInput = document.getElementById('svgInput');
            const convertButton = document.getElementById('convertButton');
            const uploadButton = document.getElementById('uploadButton');
            const fileInput = document.getElementById('fileInput');
            const errorMessage = document.getElementById('error-message');
            const svgPreviewContainer = document.getElementById('svg-preview-container');
            const outputContainer = document.getElementById('output-container');
            const outputFilename = document.getElementById('output-filename');
            const outputCode = document.getElementById('output-code');
            const copyButton = document.getElementById('copyButton');
            const downloadButton = document.getElementById('downloadButton');
            
            let tsxOutputCache = '';

            // --- Helper Functions ---
            const toPascalCase = (str) => {
                if (!str) return '';
                return str
                    .match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)
                    .map(x => x.charAt(0).toUpperCase() + x.slice(1).toLowerCase())
                    .join('');
            };

            const setError = (msg) => {
                errorMessage.textContent = msg;
            };

            const updateSvgPreview = () => {
                const svgContent = svgInput.value.trim();
                if (!svgContent) {
                    svgPreviewContainer.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="opacity-50">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><g><path d="M10.41,17.41a2,2,0,0,0,2.83,0l3.17-3.17a2,2,0,0,0,0-2.83L13.24,8.24a2,2,0,0,0-2.83,0L7.24,11.41a2,2,0,0,0,0,2.83Z"></path></g>
                        </svg>
                        <span class="ml-4">Your SVG will be previewed here.</span>`;
                    return;
                }
                 // Basic sanitization: remove script tags. For production, use a library like DOMPurify.
                const sanitizedSvg = svgContent.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
                svgPreviewContainer.innerHTML = sanitizedSvg;
                const svgElement = svgPreviewContainer.querySelector('svg');
                if (svgElement) {
                    svgElement.style.width = '100px';
                    svgElement.style.height = '100px';
                }
            };
            
            // --- Drag and Drop Logic ---
            const setupDragAndDrop = () => {
                svgInput.addEventListener('dragover', (event) => {
                    event.preventDefault();
                    svgInput.classList.add('drag-over');
                });

                svgInput.addEventListener('dragleave', () => {
                    svgInput.classList.remove('drag-over');
                });

                svgInput.addEventListener('drop', (event) => {
                    event.preventDefault();
                    svgInput.classList.remove('drag-over');
                    const file = event.dataTransfer.files[0];
                    handleFile(file);
                });
            };

            const handleFile = (file) => {
                 if (file && file.type === "image/svg+xml") {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        svgInput.value = e.target.result;
                        updateSvgPreview();
                        if (!iconNameInput.value) {
                            const fileName = file.name.replace('.svg', '');
                            iconNameInput.value = fileName;
                        }
                    };
                    reader.readAsText(file);
                    setError('');
                } else {
                    setError('Please drop a valid .svg file.');
                }
            };

            // --- AI Conversion Logic ---
            async function callGeminiToConvert() {
                const iconName = iconNameInput.value.trim();
                const svgContent = svgInput.value.trim();

                if (!svgContent || !iconName) {
                    setError('Please provide both an icon name and SVG content.');
                    return;
                }
                
                setLoading(true);
                setError('');
                outputContainer.classList.add('hidden');

                const systemPrompt = `You are an expert SVG to React TSX component converter. Your task is to convert the provided SVG code into a clean, reusable, and typed React component.

Follow these rules STRICTLY:

1.  **Component Naming:** The component name MUST be the user-provided "Icon Name" converted to PascalCase, with "Icon" appended at the end. For example, if the name is "analytics", the component name is "AnalyticsIcon".
2.  **File Structure:** Generate only a single, raw TSX code block. Do NOT include any explanatory text, markdown formatting, or backticks like \`\`\`tsx around the code.
3.  **TypeScript Interface:** ALWAYS include the \`IconProps\` interface:
    \`\`\`typescript
    export interface IconProps extends React.SVGProps<SVGSVGElement> {
      size?: number | string;
      color?: string;
      className?: string;
    }
    \`\`\`
4.  **Component Signature:** The component must be a \`React.FC<IconProps>\` with destructured props and default values as shown:
    \`\`\`typescript
    const ComponentName: React.FC<IconProps> = ({
      size = 24,
      width,
      height,
      color = 'currentColor',
      className = '',
      ...props
    }) => { ... };
    \`\`\`
5.  **SVG Attributes:**
    - The root \`<svg>\` element's \`width\` and \`height\` attributes must be set to \`{iconWidth}\` and \`{iconHeight}\` respectively. Define these constants inside the component: \`const iconWidth = width || size;\` and \`const iconHeight = height || size;\`.
    - Propagate \`className\` and any other remaining \`...props\` to the root \`<svg>\` element.
    - Convert all kebab-case SVG attributes (e.g., \`stroke-width\`) to camelCase (e.g., \`strokeWidth\`) for JSX.
    - For any \`fill\` or \`stroke\` attribute that is NOT 'none' or a \`url()\`, replace its value with \`{color}\`.
    - Preserve the \`viewBox\` attribute from the original SVG.
6.  **Export:** The component must be exported as the default export. \`export default ComponentName;\`
7.  **Imports:** Start the file with \`import React from 'react';\`.`;
                
                const userQuery = `Icon Name: "${iconName}"\n\nSVG Code:\n\`\`\`xml\n${svgContent}\n\`\`\``;
                const apiKey = "AIzaSyAv4hnQi6OC_KojYx6KClJcTmvYoBHY98c"; // API Key Added
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    // Exponential backoff for retries
                    let response;
                    let retries = 3;
                    let delay = 1000;
                    for (let i = 0; i < retries; i++) {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (response.ok) break;
                        if (response.status === 429 && i < retries - 1) {
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                        } else {
                            throw new Error(`API error: ${response.status} ${response.statusText}`);
                        }
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    let generatedCode = candidate?.content?.parts?.[0]?.text;

                    if (generatedCode) {
                        generatedCode = generatedCode.replace(/^```tsx\n?/, '').replace(/\n?```$/, '');
                        const componentName = toPascalCase(iconName) + 'Icon';
                        tsxOutputCache = generatedCode;
                        outputCode.textContent = generatedCode;
                        outputFilename.textContent = `${componentName}.tsx`;
                        Prism.highlightElement(outputCode);
                        outputContainer.classList.remove('hidden');
                        outputContainer.classList.add('fade-in');
                    } else {
                        throw new Error("AI did not return valid code. Check the console for details.");
                    }

                } catch (e) {
                    setError(`Generation failed: ${e.message}`);
                    console.error("Error payload:", payload);
                    console.error("Error response:", e);
                } finally {
                    setLoading(false);
                }
            }

            function setLoading(isLoading) {
                convertButton.disabled = isLoading;
                if (isLoading) {
                    convertButton.innerHTML = `
                        <div class="flex items-center justify-center">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Generating...
                        </div>`;
                } else {
                    convertButton.textContent = 'Generate Component';
                }
            }
            
            function copyToClipboard() {
                if (!tsxOutputCache) return;
                const textarea = document.createElement('textarea');
                textarea.value = tsxOutputCache;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    const originalIcon = copyButton.innerHTML;
                    copyButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-green-400"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    `;
                    setTimeout(() => { copyButton.innerHTML = originalIcon; }, 2000);
                } catch (err) {
                    setError('Failed to copy to clipboard.');
                    console.error('Copy failed', err);
                }
                document.body.removeChild(textarea);
            }

            function downloadFile() {
                if (!tsxOutputCache) return;
                const componentName = toPascalCase(iconNameInput.value) + 'Icon';
                const blob = new Blob([tsxOutputCache], { type: 'text/typescript-jsx;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${componentName}.tsx`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            // --- Event Listeners ---
            svgInput.addEventListener('input', updateSvgPreview);
            convertButton.addEventListener('click', callGeminiToConvert);
            uploadButton.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (event) => {
                handleFile(event.target.files[0]);
            });
            copyButton.addEventListener('click', copyToClipboard);
            downloadButton.addEventListener('click', downloadFile);
            
            // --- Initial Setup ---
            setupDragAndDrop();
        });
    </script>
</body>
</html>

